os:
  - linux

language: cpp
dist: xenial

before_install:
  - sudo add-apt-repository ppa:ubuntu-toolchain-r/test -y
  - sudo add-apt-repository ppa:savoury1/boost-defaults-1.71 -y
  - sudo apt-get update
  - sudo apt-get install -y gcc-9 g++-9
  - sudo apt-get install -y boost1.71
  - pip install --user cpp-coveralls

addons:
  apt:
    packages:
      - catch
      - cmake
      - qtbase5-dev
      - libfreeimageplus-dev
      - doxygen
      - cppcheck
      - libclang-6.0-dev
      - clang-tools-6.0
      - clang-format-6.0
      - clang-tidy-6.0
      - liblog4cxx-dev

branches:
  only:
    - master
    - devel

script:
  - mkdir -p build && cd build
  - cmake -DCMAKE_C_COMPILER=gcc-9 -DCMAKE_CXX_COMPILER=g++-9 -DLIBRA_TESTS=yes -DLIBRA_CODE_COV=yes ..
  - make -j 4
  - make unit-tests
  - make test
  - make coverage-report

after_success:
  - coveralls --root . -E ".*ext.*" -E ".*CmakeFiles.*"
